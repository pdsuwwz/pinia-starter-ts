import{d as f,u as V,f as T,_,o as g,b as C,g as n,w as r,r as o,e as h,t as j,l as N,h as S,i as y,n as E,j as w,c as $,k as B,m as b,p as I,q as F}from"./index-0P_Mg-rp.js";import{_ as H}from"./pinia-DhWULjGQ.js";import{N as D}from"./NavBar-IlOprs-M.js";import M from"./ProjectForm-B2MBp4FR.js";import R from"./TableHeader-Co2C1G4G.js";import{c as q,P as A,u as U}from"./TableBody-BYlzJFEv.js";import{l as x}from"./lodash-CziOUUxf.js";import"./Translations-BP_5lo_6.js";import"./ProjectItem-BjG43Gpq.js";const K=f({name:"NavigationSideLogo",setup(){const e=V();return{title:T(()=>e.t("base.systemTitle"))}}}),z={class:"side-logo-container"},G={class:"side-logo-title"};function J(e,t,s,a,c,l){const i=o("router-link");return g(),C("div",z,[n(i,{to:`/${e.$route.params.locale||""}`},{default:r(()=>[t[0]||(t[0]=h("img",{class:"side-logo-img",src:H,alt:"商标"},null,-1)),h("h1",G,j(e.title),1)]),_:1},8,["to"])])}const O=_(K,[["render",J],["__scopeId","data-v-2f8aeff0"]]),Q=f({name:"SearchSelect",components:{Loading:N},props:{modelValue:{type:String,default:""},placeholder:{type:String,default:""},fetch:{type:Function,default(){return()=>{}}}},emits:["update:modelValue","change","select"],setup(e){const{proxy:t}=w(),s=S(!1),a=S("");return y(()=>e.modelValue,c=>{a.value=c},{immediate:!0}),y(()=>a,x.debounce(c=>{t.$emit("update:modelValue",c),t.$emit("change",c)},300)),{loading:s,searchValue:a}},methods:{keydown(e){e.keyCode===229&&(e.returnValue=!1,e.stopPropagation()),e.keyCode===32&&(e.returnValue=!1)},getExecText(e){return e.replace(new RegExp(/(<([^>]+)>)/,"gi"),"")},handleSelect({value:e}){this.$emit("select",e)},async handleSearch(e,t){const s=e.toLowerCase().replace(new RegExp(/[-[\]{}()*+?.,\\^$|#\s]/g),"\\$&");let a=[];if(!s){t(a);return}this.loading=!0,a=await this.fetch(s)||[],a.forEach(l=>{l.label=l.label.replace(new RegExp(s,"gi"),i=>`<span class="search-select-highlight">${i}</span>`)}),t(a),setTimeout(()=>{E(()=>{this.loading=!1})},200)}}}),W={class:"search-icon"},X=["title","innerHTML"];function Y(e,t,s,a,c,l){const i=o("loading"),p=o("el-icon"),m=o("IconFont"),u=o("el-autocomplete");return g(),$(u,b({modelValue:e.searchValue,"onUpdate:modelValue":t[0]||(t[0]=d=>e.searchValue=d),modelModifiers:{trim:!0}},e.$attrs,{class:"search-input-container","popper-class":"search-select-container","trigger-on-focus":!1,"fetch-suggestions":e.handleSearch,placeholder:e.placeholder,onSelect:e.handleSelect,onKeydownCapture:t[1]||(t[1]=d=>e.keydown(d))}),B({default:r(({item:d})=>[h("span",{title:e.getExecText(d.label),innerHTML:d.label},null,8,X)]),_:2},[e.loading?{name:"suffix",fn:r(()=>[n(p,{class:"search-loading-icon"},{default:r(()=>[n(i)]),_:1})]),key:"0"}:{name:"suffix",fn:r(()=>[h("i",W,[n(m,{icon:"iconsearch"})])]),key:"1"}]),1040,["modelValue","fetch-suggestions","placeholder","onSelect"])}const Z=_(Q,[["render",Y]]),ee=f({name:"SearchCorporation",components:{SearchSelect:Z},emits:["select"],setup(){return{searchValue:S("")}},methods:{async handleFetchSearch(e){return q.map(t=>({value:t,label:t}))},handleSelectSearch(e){this.$emit("select",e)}}});function te(e,t,s,a,c,l){const i=o("SearchSelect");return g(),$(i,b({modelValue:e.searchValue,"onUpdate:modelValue":t[0]||(t[0]=p=>e.searchValue=p),fetch:e.handleFetchSearch,placeholder:"搜索项目","select-when-unmatched":"","highlight-first-item":""},e.$attrs,{onSelect:e.handleSelectSearch}),null,16,["modelValue","fetch","onSelect"])}const oe=_(ee,[["render",te]]),ae=f({name:"ProjectList",components:{NavigationNavBar:D,NavigationSideLogo:O,ProjectTableHeader:R,ProjectTableBody:A,SearchCorporation:oe},setup(){const{proxy:e}=w(),t=U(),s=V();function a(){const l=I({name:"",corpName:"",notes:""});e.$ModalDialog({title:s.t("project.create"),top:"10vh",width:"50vw","show-close":!0,"close-on-click-modal":!1,"close-on-press-escape":!1,renderComponent:{data:l,component:M},async onConfirm(i,p){if(!await i.validateRules())return Promise.reject(new Error("error"));p.fullLoading=!0;const{error:u,data:d}=await t.createProject(l);if(p.fullLoading=!1,u)return Promise.reject(new Error("error"));t.getProjectList()}})}function c(l){t.getProjectList({kw:l})}return c(),{localeInject:s,handleCreateProject:a,handleSelectSearch:c}}});function ne(e,t,s,a,c,l){const i=o("NavigationSideLogo"),p=o("NavigationNavBar"),m=o("IconFont"),u=o("el-button"),d=o("LayoutSection"),L=o("el-date-picker"),P=o("ProjectTableHeader"),k=o("ProjectTableBody"),v=o("LayoutArea");return g(),$(v,null,{top:r(()=>[n(p,{fixed:!1},{default:r(()=>[n(i)]),_:1})]),side:r(()=>[n(d,{title:e.localeInject.t("project.manageTitle")},{default:r(()=>[n(u,{type:"primary",class:"create-action",onClick:t[0]||(t[0]=re=>e.handleCreateProject())},{default:r(()=>[n(m,{icon:"iconestablish"}),F(" "+j(e._t("project.create")),1)]),_:1})]),_:1},8,["title"])]),content:r(()=>[n(d,{"has-divider":"","flex-content":""},{head:r(()=>[n(L,{"start-placeholder":e._t("base.i18nTest"),"end-placeholder":e._t("base.i18nTest"),type:"datetimerange"},null,8,["start-placeholder","end-placeholder"])]),default:r(()=>[n(P),n(k)]),_:1})]),_:1})}const fe=_(ae,[["render",ne],["__scopeId","data-v-79ac1b3d"]]);export{fe as default};
