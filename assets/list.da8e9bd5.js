import{_ as $}from"./pinia.8a788826.js";import{_ as m,u as w}from"./index.372b9409.js";import{g,Y as V,j as T,r as l,o as p,t as N,n as r,m as n,v as f,I as x,M as k,O as E,a0 as I,L as v,w as j,X as F,l as y,a2 as H,H as L,P as M,S as B}from"./vendor.de96c8ce.js";import{N as R}from"./NavBar.1add5e8d.js";import U from"./ProjectForm.e6af8e54.js";import A from"./TableHeader.302d26f9.js";import{c as D,P as K,u as O}from"./TableBody.366880c3.js";import{l as X}from"./lodash.0e92c50f.js";import"./Translations.94e93fbf.js";import"./ProjectItem.9448eb37.js";const Y=g({name:"NavigationSideLogo",setup(){const e=V();return{title:T(()=>e.t("base.systemTitle"))}}}),q={class:"side-logo-container"},z=(e=>(k("data-v-9d01dd8c"),e=e(),E(),e))(()=>f("img",{class:"side-logo-img",src:$,alt:"\u5546\u6807"},null,-1)),G={class:"side-logo-title"};var J=m(Y,[["render",function(e,t,c,o,a,d){const s=l("router-link");return p(),N("div",q,[r(s,{to:`/${e.$route.params.locale||""}`},{default:n(()=>[z,f("h1",G,x(e.title),1)]),_:1},8,["to"])])}],["__scopeId","data-v-9d01dd8c"]]);const Q=g({name:"SearchSelect",components:{Loading:I},props:{modelValue:{type:String,default:""},placeholder:{type:String,default:""},fetch:{type:Function,default:()=>()=>{}}},emits:["update:modelValue","change","select"],setup(e){const{proxy:t}=w(),c=v(!1),o=v("");return j(()=>e.modelValue,a=>{o.value=a},{immediate:!0}),j(()=>o,X.exports.debounce(function(a){t.$emit("update:modelValue",a),t.$emit("change",a)},300)),{loading:c,searchValue:o}},methods:{keydown(e){e.keyCode===229&&(e.returnValue=!1,e.stopPropagation()),e.keyCode===32&&(e.returnValue=!1)},getExecText:e=>e.replace(new RegExp(/(<([^>]+)>)/,"gi"),""),handleSelect({value:e}){this.$emit("select",e)},async handleSearch(e,t){const c=e.toLowerCase().replace(new RegExp(/[-[\]{}()*+?.,\\^$|#\s]/g),"\\$&");let o=[];if(!c)return void t(o);this.loading=!0,o=await this.fetch(c)||[],o.forEach(a=>{a.label=a.label.replace(new RegExp(c,"gi"),d=>`<span class="search-select-highlight">${d}</span>`)}),t(o),setTimeout(()=>{F(()=>{this.loading=!1})},200)}}}),W=["title","innerHTML"],Z=g({name:"SearchCorporation",components:{SearchSelect:m(Q,[["render",function(e,t,c,o,a,d){const s=l("loading"),u=l("el-icon"),h=l("IconFont"),S=l("el-autocomplete");return p(),y(S,L({modelValue:e.searchValue,"onUpdate:modelValue":t[0]||(t[0]=i=>e.searchValue=i),modelModifiers:{trim:!0}},e.$attrs,{class:"search-input-container","popper-class":"search-select-container","trigger-on-focus":!1,"fetch-suggestions":e.handleSearch,placeholder:e.placeholder,onSelect:e.handleSelect,onKeydownCapture:t[1]||(t[1]=i=>e.keydown(i))}),H({default:n(({item:i})=>[f("span",{title:e.getExecText(i.label),innerHTML:i.label},null,8,W)]),_:2},[e.loading?{name:"suffix",fn:n(()=>[r(u,{class:"search-loading-icon"},{default:n(()=>[r(s)]),_:1})])}:{name:"suffix",fn:n(()=>[f("i",{class:"search-icon"},[r(h,{icon:"iconsearch"})])])}]),1040,["modelValue","fetch-suggestions","placeholder","onSelect"])}]])},emits:["select"],setup:()=>({searchValue:v("")}),methods:{handleFetchSearch:async e=>D.map(t=>({value:t,label:t})),handleSelectSearch(e){this.$emit("select",e)}}});var ue=m(g({name:"ProjectList",components:{NavigationNavBar:R,NavigationSideLogo:J,ProjectTableHeader:A,ProjectTableBody:K,SearchCorporation:m(Z,[["render",function(e,t,c,o,a,d){const s=l("SearchSelect");return p(),y(s,L({modelValue:e.searchValue,"onUpdate:modelValue":t[0]||(t[0]=u=>e.searchValue=u),fetch:e.handleFetchSearch,placeholder:"\u641C\u7D22\u9879\u76EE","select-when-unmatched":"","highlight-first-item":""},e.$attrs,{onSelect:e.handleSelectSearch}),null,16,["modelValue","fetch","onSelect"])}]])},setup(){const{proxy:e}=w(),t=O(),c=V();function o(a){t.getProjectList({kw:a})}return o(),{localeInject:c,handleCreateProject:function(){const a=B({name:"",corpName:"",notes:""});e.$ModalDialog({title:c.t("project.create"),top:"10vh",width:"50vw","show-close":!0,"close-on-click-modal":!1,"close-on-press-escape":!1,renderComponent:{data:a,component:U},async onConfirm(d,s){if(!await d.validateRules())return Promise.reject(new Error("error"));s.fullLoading=!0;const{error:u,data:h}=await t.createProject(a);if(s.fullLoading=!1,u)return Promise.reject(new Error("error"));t.getProjectList()}})},handleSelectSearch:o}}}),[["render",function(e,t,c,o,a,d){const s=l("NavigationSideLogo"),u=l("NavigationNavBar"),h=l("IconFont"),S=l("el-button"),i=l("LayoutSection"),P=l("SearchCorporation"),_=l("ProjectTableHeader"),b=l("ProjectTableBody"),C=l("LayoutArea");return p(),y(C,null,{top:n(()=>[r(u,{fixed:!1},{default:n(()=>[r(s)]),_:1})]),side:n(()=>[r(i,{title:e.localeInject.t("project.manageTitle")},{default:n(()=>[r(S,{type:"primary",class:"create-action",onClick:t[0]||(t[0]=ee=>e.handleCreateProject())},{default:n(()=>[r(h,{icon:"iconestablish"}),M(" "+x(e._t("project.create")),1)]),_:1})]),_:1},8,["title"])]),content:n(()=>[r(i,{"has-divider":"","flex-content":""},{head:n(()=>[r(P,{onSelect:e.handleSelectSearch},null,8,["onSelect"])]),default:n(()=>[r(_),r(b)]),_:1})]),_:1})}],["__scopeId","data-v-51b433dc"]]);export{ue as default};
